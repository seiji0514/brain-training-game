<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Êï∞Â≠óÂêà„Çè„Åõ</title>
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        @keyframes correct {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --accent-color: #e74c3c;
            --success-color: #27ae60;
            --background-color: #f0f8ff;
            --text-color: #2c3e50;
            --animation-duration: 0.3s;
        }

        [data-theme="dark"] {
            --primary-color: #2980b9;
            --secondary-color: #ecf0f1;
            --accent-color: #e74c3c;
            --success-color: #2ecc71;
            --background-color: #2c3e50;
            --text-color: #ecf0f1;
        }

        [data-theme="warm"] {
            --primary-color: #e67e22;
            --secondary-color: #d35400;
            --accent-color: #c0392b;
            --success-color: #27ae60;
            --background-color: #fef5e7;
            --text-color: #7f8c8d;
        }

        body {
            font-family: "Hiragino Kaku Gothic Pro", "„É°„Ç§„É™„Ç™", sans-serif;
            background-color: var(--background-color);
            text-align: center;
            padding: 20px;
            color: var(--text-color);
            transition: all var(--animation-duration) ease;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            animation: fadeIn 0.5s ease-out;
        }

        h1 {
            font-size: 3em;
            color: var(--secondary-color);
            margin-bottom: 30px;
            animation: pulse 2s infinite;
        }

        .game-area {
            margin: 20px 0;
        }

        .number-display {
            font-size: 5em;
            color: var(--accent-color);
            margin: 20px 0;
            font-weight: bold;
            transition: all var(--animation-duration);
        }

        .number-display.correct {
            animation: correct 0.5s;
        }

        .number-display.wrong {
            animation: shake 0.5s;
        }

        .buttons {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 15px;
            margin: 20px auto;
            max-width: 800px;
        }

        button {
            font-size: 2em;
            padding: 20px;
            border: none;
            border-radius: 15px;
            background-color: var(--primary-color);
            color: white;
            cursor: pointer;
            transition: all var(--animation-duration);
            position: relative;
            overflow: hidden;
        }

        button:hover {
            background-color: var(--secondary-color);
            transform: scale(1.05);
        }

        button:active {
            transform: scale(0.95);
        }

        button::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.5);
            opacity: 0;
            border-radius: 100%;
            transform: scale(1, 1) translate(-50%);
            transform-origin: 50% 50%;
        }

        button:focus:not(:active)::after {
            animation: ripple 1s ease-out;
        }

        @keyframes ripple {
            0% {
                transform: scale(0, 0);
                opacity: 0.5;
            }
            100% {
                transform: scale(20, 20);
                opacity: 0;
            }
        }

        .score {
            font-size: 2em;
            color: var(--success-color);
            margin: 20px 0;
            transition: all var(--animation-duration);
        }

        .message {
            font-size: 1.8em;
            margin: 20px 0;
            min-height: 1.5em;
            transition: all var(--animation-duration);
        }

        .mode-selector {
            margin: 20px 0;
        }

        .mode-button {
            font-size: 1.2em;
            padding: 10px 20px;
            margin: 0 10px;
            background-color: var(--primary-color);
        }

        .mode-button.active {
            background-color: var(--secondary-color);
            transform: scale(1.1);
        }

        .timer {
            font-size: 1.5em;
            color: var(--accent-color);
            margin: 10px 0;
        }

        .level-indicator {
            font-size: 1.5em;
            color: var(--secondary-color);
            margin: 10px 0;
        }

        .settings-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            z-index: 100;
        }

        .settings-button {
            font-size: 1em;
            padding: 5px 10px;
            margin: 5px;
            background-color: var(--primary-color);
        }

        .high-scores {
            position: fixed;
            top: 20px;
            left: 20px;
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            text-align: left;
            z-index: 100;
        }

        .stats-panel {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            z-index: 100;
            display: none;
        }

        .theme-creator {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(0,0,0,0.2);
            z-index: 1000;
            display: none;
        }

        .color-picker {
            margin: 10px 0;
        }

        .color-picker label {
            display: block;
            margin-bottom: 5px;
        }

        .color-picker input {
            width: 100%;
            margin-bottom: 10px;
        }

        .tutorial-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .tutorial-content {
            background: white;
            padding: 20px;
            border-radius: 15px;
            max-width: 600px;
            text-align: left;
        }

        .tutorial-step {
            display: none;
        }

        .tutorial-step.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        .difficulty-selector {
            margin: 10px 0;
        }

        .theme-selector {
            margin: 10px 0;
        }

        .keyboard-hint {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 10px;
            border-radius: 5px;
            font-size: 0.9em;
            display: none;
        }

        .accessibility-panel {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            z-index: 100;
            display: none;
        }

        .social-panel {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            z-index: 100;
            display: none;
        }

        .analytics-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(0,0,0,0.2);
            z-index: 1000;
            display: none;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .combo-indicator {
            font-size: 1.5em;
            color: var(--accent-color);
            margin: 10px 0;
            display: none;
        }

        .power-up {
            position: absolute;
            width: 30px;
            height: 30px;
            background: var(--accent-color);
            border-radius: 50%;
            animation: float 2s infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .mission-panel {
            position: fixed;
            top: 20px;
            left: 20px;
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            z-index: 100;
            display: none;
        }

        .achievement {
            display: inline-block;
            margin: 5px;
            padding: 5px 10px;
            background: var(--primary-color);
            color: white;
            border-radius: 5px;
            font-size: 0.9em;
        }

        .achievement.unlocked {
            background: var(--success-color);
        }

        .game-mode-selector {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 20px 0;
        }

        .game-mode-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .game-mode-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: translateX(-100%);
            transition: transform 0.5s ease;
        }

        .game-mode-card:hover::before {
            transform: translateX(100%);
        }

        .game-mode-card.active {
            border: 3px solid var(--primary-color);
            transform: scale(1.05);
        }

        .game-mode-icon {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .game-mode-title {
            font-size: 1.5em;
            margin-bottom: 10px;
            color: var(--secondary-color);
        }

        .game-mode-description {
            font-size: 1em;
            color: var(--text-color);
            margin-bottom: 10px;
        }

        .game-mode-difficulty {
            font-size: 0.9em;
            color: var(--accent-color);
        }

        .game-mode-new {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--accent-color);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8em;
        }

        .feature-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            z-index: 100;
        }

        .feature-button {
            font-size: 1em;
            padding: 5px 10px;
            margin: 5px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .feature-button:hover {
            background-color: var(--secondary-color);
            transform: scale(1.05);
        }

        .feature-panel-content {
            display: none;
            margin-top: 10px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 5px;
        }

        .feature-panel-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin: 10px 0;
        }

        .calendar-day {
            padding: 5px;
            text-align: center;
            border-radius: 5px;
            cursor: pointer;
        }

        .calendar-day.active {
            background-color: var(--primary-color);
            color: white;
        }

        .achievement-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .achievement-item {
            padding: 10px;
            margin: 5px 0;
            background: var(--background-color);
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .achievement-progress {
            width: 100%;
            height: 10px;
            background: #ddd;
            border-radius: 5px;
            margin-top: 5px;
        }

        .achievement-progress-bar {
            height: 100%;
            background: var(--success-color);
            border-radius: 5px;
            transition: width 0.3s ease;
        }

        .training-plan {
            margin: 10px 0;
            padding: 10px;
            background: var(--background-color);
            border-radius: 5px;
        }

        .training-exercise {
            margin: 5px 0;
            padding: 5px;
            background: white;
            border-radius: 3px;
        }

        .medal {
            display: inline-block;
            width: 30px;
            height: 30px;
            margin-right: 10px;
            background-size: contain;
            background-repeat: no-repeat;
        }

        .medal-gold { background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23FFD700"><path d="M12 2L15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2z"/></svg>'); }
        .medal-silver { background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23C0C0C0"><path d="M12 2L15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2z"/></svg>'); }
        .medal-bronze { background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23CD7F32"><path d="M12 2L15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2z"/></svg>'); }

        .advanced-feature-panel {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            z-index: 100;
        }

        .advanced-feature-button {
            font-size: 1em;
            padding: 5px 10px;
            margin: 5px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .advanced-feature-button:hover {
            background-color: var(--secondary-color);
            transform: scale(1.05);
        }

        .advanced-feature-content {
            display: none;
            margin-top: 10px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 5px;
        }

        .advanced-feature-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .performance-graph {
            width: 100%;
            height: 200px;
            background: var(--background-color);
            border-radius: 5px;
            margin: 10px 0;
            position: relative;
        }

        .performance-line {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: var(--primary-color);
            transform-origin: left;
            transition: transform 0.3s ease;
        }

        .performance-point {
            position: absolute;
            width: 8px;
            height: 8px;
            background: var(--accent-color);
            border-radius: 50%;
            transform: translate(-50%, -50%);
        }

        .ai-suggestion {
            padding: 10px;
            margin: 5px 0;
            background: var(--background-color);
            border-radius: 5px;
            border-left: 4px solid var(--primary-color);
        }

        .custom-game-creator {
            margin: 10px 0;
            padding: 10px;
            background: var(--background-color);
            border-radius: 5px;
        }

        .custom-game-option {
            margin: 5px 0;
            padding: 5px;
            background: white;
            border-radius: 3px;
        }

        .voice-control-panel {
            margin: 10px 0;
            padding: 10px;
            background: var(--background-color);
            border-radius: 5px;
        }

        .voice-command {
            display: inline-block;
            padding: 5px 10px;
            margin: 5px;
            background: var(--primary-color);
            color: white;
            border-radius: 15px;
            font-size: 0.9em;
        }

        .multiplayer-panel {
            margin: 10px 0;
            padding: 10px;
            background: var(--background-color);
            border-radius: 5px;
        }

        .player-list {
            max-height: 200px;
            overflow-y: auto;
        }

        .player-item {
            display: flex;
            align-items: center;
            padding: 5px;
            margin: 5px 0;
            background: white;
            border-radius: 3px;
        }

        .player-status {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 10px;
        }

        .player-status.online { background: var(--success-color); }
        .player-status.away { background: var(--accent-color); }
        .player-status.offline { background: #ccc; }

        .menu-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 2000;
            background: var(--primary-color);
            color: #fff;
            border: none;
            border-radius: 50%;
            width: 56px;
            height: 56px;
            font-size: 2em;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }
        .menu-toggle:hover {
            background: var(--secondary-color);
        }

        .menu-panel {
            position: fixed;
            top: 0;
            right: 0;
            width: 280px;
            height: 100vh;
            background: #fff;
            box-shadow: -2px 0 8px rgba(0,0,0,0.15);
            z-index: 2100;
            display: none;
            flex-direction: column;
            padding: 32px 16px 16px 16px;
            transition: transform 0.3s cubic-bezier(.4,0,.2,1);
            border-radius: 0 0 0 16px;
        }
        .menu-panel.open {
            display: flex;
        }
        .menu-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .menu-list li {
            margin-bottom: 20px;
        }
        .menu-list a {
            display: block;
            font-size: 1.2em;
            padding: 16px 8px;
            color: var(--primary-color);
            text-decoration: none;
            border-radius: 8px;
            transition: background 0.2s, color 0.2s;
        }
        .menu-list a:hover {
            background: var(--primary-color);
            color: #fff;
        }

        .modal {
            position: fixed;
            z-index: 3000;
            left: 0; top: 0; width: 100vw; height: 100vh;
            background: rgba(0,0,0,0.4);
            display: flex; align-items: center; justify-content: center;
        }
        .modal-content {
            background: #fff;
            padding: 32px 24px;
            border-radius: 12px;
            min-width: 300px;
            text-align: center;
            position: relative;
        }
        .close {
            position: absolute;
            top: 8px; right: 16px;
            font-size: 2em;
            color: #888;
            cursor: pointer;
        }
        .close:hover { color: #e74c3c; }
    </style>
</head>
<body>
    <!-- „É°„Éã„É•„Éº„Éú„Çø„É≥ÔºàÂè≥‰∏äÂõ∫ÂÆöÔºâ -->
    <button class="menu-toggle" onclick="toggleMenu()" aria-label="„É°„Éã„É•„Éº„ÇíÈñã„Åè">
        &#9776;
    </button>

    <!-- „É°„Éã„É•„Éº„Éë„Éç„É´ÔºàÂè≥„Åã„Çâ„Çπ„É©„Ç§„Éâ„Ç§„É≥Ôºâ -->
    <nav class="menu-panel">
        <ul class="menu-list">
            <li><a href="#home" onclick="toggleMenu();">„Éõ„Éº„É†</a></li>
            <li><a href="javascript:void(0);" onclick="openScoreModal();">„Çπ„Ç≥„Ç¢</a></li>
            <li><a href="javascript:void(0);" onclick="openSettingsModal();">Ë®≠ÂÆö</a></li>
            <li><a href="javascript:void(0);" onclick="openHelpModal();">„Éò„É´„Éó„ÉªÈÅä„Å≥Êñπ</a></li>
        </ul>
    </nav>

    <div id="home" class="container">
        <h1>ËÑ≥„Éà„É¨„Ç≤„Éº„É†</h1>
        <div class="game-mode-selector">
            <div class="game-mode-card" onclick="setGameType('number')">
                <div class="game-mode-icon">üî¢</div>
                <div class="game-mode-title">Êï∞Â≠óÂêà„Çè„Åõ</div>
                <div class="game-mode-description">Ë°®Á§∫„Åï„Çå„ÅüÊï∞Â≠ó„Å®Âêå„ÅòÊï∞Â≠ó„ÇíÈÅ∏„Å∂„Ç≤„Éº„É†</div>
                <div class="game-mode-difficulty">Èõ£ÊòìÂ∫¶: ‚òÖ‚òÜ‚òÜ</div>
            </div>
            <div class="game-mode-card" onclick="setGameType('memory')">
                <div class="game-mode-icon">üß†</div>
                <div class="game-mode-title">Ë®òÊÜ∂Âäõ„Ç≤„Éº„É†</div>
                <div class="game-mode-description">Ë°®Á§∫„Åï„Çå„Åü„Éë„Çø„Éº„É≥„ÇíË®òÊÜ∂„Åó„Å¶ÂÜçÁèæ„Åô„Çã„Ç≤„Éº„É†</div>
                <div class="game-mode-difficulty">Èõ£ÊòìÂ∫¶: ‚òÖ‚òÖ‚òÜ</div>
            </div>
            <div class="game-mode-card" onclick="setGameType('calculation')">
                <div class="game-mode-icon">üßÆ</div>
                <div class="game-mode-title">Ë®àÁÆó„Ç≤„Éº„É†</div>
                <div class="game-mode-description">Á∞°Âçò„Å™Ë®àÁÆóÂïèÈ°å„Å´Á≠î„Åà„Çã„Ç≤„Éº„É†</div>
                <div class="game-mode-difficulty">Èõ£ÊòìÂ∫¶: ‚òÖ‚òÖ‚òÜ</div>
            </div>
            <div class="game-mode-card" onclick="setGameType('word')">
                <div class="game-mode-icon">üìù</div>
                <div class="game-mode-title">ÊñáÂ≠ó„Ç≤„Éº„É†</div>
                <div class="game-mode-description">ÊñáÂ≠ó„ÇíÁµÑ„ÅøÂêà„Çè„Åõ„Å¶ÂçòË™û„Çí‰Ωú„Çã„Ç≤„Éº„É†</div>
                <div class="game-mode-difficulty">Èõ£ÊòìÂ∫¶: ‚òÖ‚òÖ‚òÜ</div>
            </div>
            <div class="game-mode-card" onclick="setGameType('reaction')">
                <div class="game-mode-icon">‚ö°</div>
                <div class="game-mode-title">ÂèçÂøú„Ç≤„Éº„É†</div>
                <div class="game-mode-description">Á¥†Êó©„ÅèÂèçÂøú„Åó„Å¶„Éú„Çø„É≥„ÇíÊäº„Åô„Ç≤„Éº„É†</div>
                <div class="game-mode-difficulty">Èõ£ÊòìÂ∫¶: ‚òÖ‚òÖ‚òÜ</div>
            </div>
            <div class="game-mode-card" onclick="setGameType('jigsaw')">
                <div class="game-mode-icon">üß©</div>
                <div class="game-mode-title">„Ç∏„Ç∞„ÇΩ„Éº„Éë„Ç∫„É´</div>
                <div class="game-mode-description">ÁîªÂÉè„Çí„Çπ„É©„Ç§„Éâ„Åó„Å¶ÂÆåÊàê„Åï„Åõ„Çã„Éë„Ç∫„É´„Ç≤„Éº„É†</div>
                <div class="game-mode-difficulty">Èõ£ÊòìÂ∫¶: ‚òÖ‚òÖ‚òÜ</div>
            </div>
            <div class="game-mode-card" onclick="setGameType('hidden-number')">
                <div class="game-mode-icon">üîç</div>
                <div class="game-mode-title">Èö†„ÇåÊï∞Â≠ó„Ç≤„Éº„É†</div>
                <div class="game-mode-description">Èö†„Çå„ÅüÊï∞Â≠ó„ÇíË¶≥ÂØü„Åó„Å¶ÂΩì„Å¶„Çã„Ç≤„Éº„É†</div>
                <div class="game-mode-difficulty">Èõ£ÊòìÂ∫¶: ‚òÖ‚òÖ‚òÜ</div>
            </div>
            <div class="game-mode-card" onclick="setGameType('memory-match')">
                <div class="game-mode-icon">üÉè</div>
                <div class="game-mode-title">Á•ûÁµåË°∞Âº±„Ç≤„Éº„É†</div>
                <div class="game-mode-description">Âêå„Åò„Ç´„Éº„Éâ„Çí„ÇÅ„Åè„Å£„Å¶„Éö„Ç¢„ÇíÊèÉ„Åà„Çã„Ç≤„Éº„É†</div>
                <div class="game-mode-difficulty">Èõ£ÊòìÂ∫¶: ‚òÖ‚òÖ‚òÜ</div>
            </div>
        </div>
        <div id="gameContent"></div>
    </div>

    <!-- „É°„Éã„É•„Éº„Éë„Éç„É´ -->
    <nav class="menu-panel" style="display:none;">
        <ul class="menu-list">
            <li><a href="#" onclick="toggleMenu();">„Éõ„Éº„É†</a></li>
            <li><a href="#" onclick="toggleMenu();">„Ç≤„Éº„É†„É¢„Éº„ÉâÈÅ∏Êäû</a></li>
            <li><a href="#" onclick="toggleMenu();">„Çπ„Ç≥„Ç¢</a></li>
            <li><a href="#" onclick="toggleMenu();">Ë®≠ÂÆö</a></li>
            <li><a href="#" onclick="toggleMenu();">„Éò„É´„Éó„ÉªÈÅä„Å≥Êñπ</a></li>
        </ul>
    </nav>

    <!-- „Çπ„Ç≥„Ç¢„É¢„Éº„ÉÄ„É´ -->
    <div id="scoreModal" class="modal" style="display:none;">
        <div class="modal-content">
            <span class="close" onclick="closeScoreModal()">&times;</span>
            <h2>„Çπ„Ç≥„Ç¢</h2>
            <p>„Éè„Ç§„Çπ„Ç≥„Ç¢Ôºö<span id="userHighScore">0</span></p>
            <p>„Éó„É¨„Ç§ÂõûÊï∞Ôºö<span id="userTotalGames">0</span></p>
        </div>
    </div>

    <!-- Ë®≠ÂÆö„É¢„Éº„ÉÄ„É´ -->
    <div id="settingsModal" class="modal" style="display:none;">
        <div class="modal-content">
            <span class="close" onclick="closeSettingsModal()">&times;</span>
            <h2>Ë®≠ÂÆö</h2>
            <div style="text-align:left; max-width:350px; margin:0 auto;">
                <label>„ÉÜ„Éº„Éû:
                    <select onchange="setTheme(this.value)">
                        <option value="light">„É©„Ç§„Éà</option>
                        <option value="dark">„ÉÄ„Éº„ÇØ</option>
                        <option value="warm">„Ç¶„Ç©„Éº„É†</option>
                    </select>
                </label>
                <br><br>
                <label>„Éï„Ç©„É≥„Éà„Çµ„Ç§„Ç∫:
                    <input id="fontSizeSlider" type="range" min="1" max="2" step="0.1" value="1" onchange="adjustFontSize(this.value)">
                    <span id="fontSizeValue">1.0</span>em
                </label>
                <br><br>
                <label>Èü≥Èáè:
                    <input id="volumeSlider" type="range" min="0" max="100" value="50" onchange="adjustVolume(this.value)">
                    <span id="volumeValue">50</span>%
                </label>
                <br><br>
                <label>„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÈÄüÂ∫¶:
                    <input id="animationSpeedSlider" type="range" min="0.1" max="1" step="0.1" value="0.3" onchange="adjustAnimationSpeed(this.value)">
                    <span id="animationSpeedValue">0.3</span>s
                </label>
                <br><br>
                <label>
                    <input type="checkbox" id="autoSaveToggle" checked>
                    Ëá™Âãï‰øùÂ≠ò
                </label>
                <br>
                <label>
                    <input type="checkbox" id="notificationToggle">
                    ÈÄöÁü•
                </label>
            </div>
        </div>
    </div>

    <!-- „Éò„É´„Éó„É¢„Éº„ÉÄ„É´ -->
    <div id="helpModal" class="modal" style="display:none;">
        <div class="modal-content">
            <span class="close" onclick="closeHelpModal()">&times;</span>
            <h2>„Éò„É´„Éó„ÉªÈÅä„Å≥Êñπ</h2>
            <p>ÂêÑ„Ç≤„Éº„É†„ÅÆË™¨Êòé„ÇÑÈÅä„Å≥Êñπ„Çí„Åì„Åì„Å´Ë®òËºâ„Åó„Åæ„Åô„ÄÇ</p>
            <ul>
                <li>Êï∞Â≠óÂêà„Çè„ÅõÔºöË°®Á§∫„Åï„Çå„ÅüÊï∞Â≠ó„Å®Âêå„ÅòÊï∞Â≠ó„ÇíÈÅ∏„Å∂„Ç≤„Éº„É†„Åß„Åô„ÄÇ</li>
                <li>Ë®òÊÜ∂Âäõ„Ç≤„Éº„É†Ôºö„Éë„Çø„Éº„É≥„ÇíË¶ö„Åà„Å¶ÂÜçÁèæ„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ</li>
                <li>„Éë„Ç∫„É´„Ç≤„Éº„É†ÔºöÊï∞Â≠ó„ÇíÊ≠£„Åó„ÅÑÈ†ÜÂ∫è„Å´‰∏¶„ÅπÊõø„Åà„Åæ„Åó„Çá„ÅÜ„ÄÇ</li>
                <li>Ë®àÁÆó„Ç≤„Éº„É†ÔºöË®àÁÆóÂïèÈ°å„Å´Á≠î„Åà„Åæ„Åó„Çá„ÅÜ„ÄÇ</li>
                <li>ÊñáÂ≠ó„Ç≤„Éº„É†ÔºöÊñáÂ≠ó„ÇíÁµÑ„ÅøÂêà„Çè„Åõ„Å¶ÂçòË™û„Çí‰Ωú„Çä„Åæ„Åó„Çá„ÅÜ„ÄÇ</li>
            </ul>
        </div>
    </div>

    <!-- Êï∞Â≠óÂêà„Çè„Åõ„Ç≤„Éº„É†„É¢„Éº„ÉÄ„É´ -->
    <div id="numberGameModal" class="modal" style="display:none;">
        <div class="modal-content" id="numberGameModalContent">
            <span class="close" onclick="closeNumberGameModal()">&times;</span>
            <!-- „Ç≤„Éº„É†UI„ÅØ„Åì„Åì„Å´ÊèèÁîª„Åï„Çå„Åæ„Åô -->
        </div>
    </div>

    <!-- Ë®òÊÜ∂Âäõ„Ç≤„Éº„É†„É¢„Éº„ÉÄ„É´ -->
    <div id="memoryGameModal" class="modal" style="display:none;">
        <div class="modal-content" id="memoryGameModalContent">
            <span class="close" onclick="closeMemoryGameModal()">&times;</span>
            <!-- Ë®òÊÜ∂Âäõ„Ç≤„Éº„É†UI„ÅØ„Åì„Åì„Å´ÊèèÁîª„Åï„Çå„Åæ„Åô -->
        </div>
    </div>

    <!-- „Éë„Çø„Éº„É≥„Ç≤„Éº„É†„É¢„Éº„ÉÄ„É´ -->
    <div id="patternGameModal" class="modal" style="display:none;">
        <div class="modal-content" id="patternGameModalContent">
            <span class="close" onclick="closePatternGameModal()">&times;</span>
            <!-- „Éë„Çø„Éº„É≥„Ç≤„Éº„É†UI„ÅØ„Åì„Åì„Å´ÊèèÁîª„Åï„Çå„Åæ„Åô -->
        </div>
    </div>

    <!-- Ë®àÁÆó„Ç≤„Éº„É†„É¢„Éº„ÉÄ„É´ -->
    <div id="calculationGameModal" class="modal" style="display:none;">
        <div class="modal-content" id="calculationGameModalContent">
            <span class="close" onclick="closeCalculationGameModal()">&times;</span>
            <!-- Ë®àÁÆó„Ç≤„Éº„É†UI„ÅØ„Åì„Åì„Å´ÊèèÁîª„Åï„Çå„Åæ„Åô -->
        </div>
    </div>

    <!-- ÊñáÂ≠ó„Ç≤„Éº„É†„É¢„Éº„ÉÄ„É´ -->
    <div id="wordGameModal" class="modal" style="display:none;">
        <div class="modal-content" id="wordGameModalContent">
            <span class="close" onclick="closeWordGameModal()">&times;</span>
            <!-- ÊñáÂ≠ó„Ç≤„Éº„É†UI„ÅØ„Åì„Åì„Å´ÊèèÁîª„Åï„Çå„Åæ„Åô -->
        </div>
    </div>

    <!-- ÂèçÂøú„Ç≤„Éº„É†„É¢„Éº„ÉÄ„É´ -->
    <div id="reactionGameModal" class="modal" style="display:none;">
        <div class="modal-content" id="reactionGameModalContent">
            <span class="close" onclick="closeReactionGameModal()">&times;</span>
            <!-- ÂèçÂøú„Ç≤„Éº„É†UI„ÅØ„Åì„Åì„Å´ÊèèÁîª„Åï„Çå„Åæ„Åô -->
        </div>
    </div>

    <!-- „Ç∏„Ç∞„ÇΩ„Éº„Éë„Ç∫„É´„Ç≤„Éº„É†„É¢„Éº„ÉÄ„É´ -->
    <div id="jigsawGameModal" class="modal" style="display:none;">
        <div class="modal-content" id="jigsawGameModalContent">
            <span class="close" onclick="closeJigsawGameModal()">&times;</span>
            <!-- „Ç∏„Ç∞„ÇΩ„Éº„Éë„Ç∫„É´UI„ÅØ„Åì„Åì„Å´ÊèèÁîª„Åï„Çå„Åæ„Åô -->
        </div>
    </div>

    <!-- Ê®™Âàá„ÇãÂõ≥ÂΩ¢„Ç≤„Éº„É†„É¢„Éº„ÉÄ„É´ -->
    <div id="crossShapeGameModal" class="modal" style="display:none;">
        <div class="modal-content" id="crossShapeGameModalContent">
            <span class="close" onclick="closeCrossShapeGameModal()">&times;</span>
            <!-- Ê®™Âàá„ÇãÂõ≥ÂΩ¢„Ç≤„Éº„É†UI„ÅØ„Åì„Åì„Å´ÊèèÁîª„Åï„Çå„Åæ„Åô -->
        </div>
    </div>

    <!-- Èö†„ÇåÊï∞Â≠ó„Ç≤„Éº„É†„É¢„Éº„ÉÄ„É´ -->
    <div id="hiddenNumberGameModal" class="modal" style="display:none;">
        <div class="modal-content" id="hiddenNumberGameModalContent">
            <span class="close" onclick="closeHiddenNumberGameModal()">&times;</span>
            <!-- Èö†„ÇåÊï∞Â≠ó„Ç≤„Éº„É†UI„ÅØ„Åì„Åì„Å´ÊèèÁîª„Åï„Çå„Åæ„Åô -->
        </div>
    </div>

    <!-- Á•ûÁµåË°∞Âº±„Ç≤„Éº„É†„É¢„Éº„ÉÄ„É´ -->
    <div id="memoryMatchGameModal" class="modal" style="display:none;">
        <div class="modal-content" id="memoryMatchGameModalContent">
            <span class="close" onclick="closeMemoryMatchGameModal()">&times;</span>
            <!-- Á•ûÁµåË°∞Âº±„Ç≤„Éº„É†UI„ÅØ„Åì„Åì„Å´ÊèèÁîª„Åï„Çå„Åæ„Åô -->
        </div>
    </div>

    <script>
    let numberGameScore = 0;
    let numberGameTarget = 0;

    function toggleMenu() {
        const menuPanel = document.querySelector('.menu-panel');
        if (menuPanel) {
            menuPanel.classList.toggle('open');
        }
    }

    function setGameType(type) {
        if (type === 'number') {
            openNumberGameModal();
        } else if (type === 'memory') {
            openMemoryGameModal();
        } else if (type === 'calculation') {
            openCalculationGameModal();
        } else if (type === 'word') {
            openWordGameModal();
        } else if (type === 'reaction') {
            openReactionGameModal();
        } else if (type === 'jigsaw') {
            openJigsawGameModal();
        } else if (type === 'cross-shape') {
            openCrossShapeGameModal();
        } else if (type === 'hidden-number') {
            openHiddenNumberGameModal();
        } else if (type === 'memory-match') {
            openMemoryMatchGameModal();
        }
    }

    function openNumberGameModal() {
        document.getElementById('numberGameModal').style.display = 'flex';
        initializeNumberGame('normal');
    }

    function closeNumberGameModal() {
        document.getElementById('numberGameModal').style.display = 'none';
    }

    function initializeNumberGame(level) {
        // „É¨„Éô„É´ÂèñÂæó
        if (!level) {
            level = document.getElementById('numberLevelSelect')?.value || 'normal';
        }
        let digit, choiceCount;
        if (level === 'easy') {
            digit = 3; choiceCount = 3;
        } else if (level === 'hard') {
            digit = 5; choiceCount = 5;
        } else {
            digit = 4; choiceCount = 4;
        }
        const min = Math.pow(10, digit - 1);
        const max = Math.pow(10, digit) - 1;
        let targetNumber = Math.floor(Math.random() * (max - min + 1)) + min;
        let score = 0;
        const modalContent = document.getElementById('numberGameModalContent');
        modalContent.innerHTML = `
            <span class="close" onclick="closeNumberGameModal()">&times;</span>
            <div style="margin-bottom:10px;">
                <label>„É¨„Éô„É´:
                    <select id="numberLevelSelect">
                        <option value="easy">Á∞°Âçò</option>
                        <option value="normal" selected>ÊôÆÈÄö</option>
                        <option value="hard">Èõ£„Åó„ÅÑ</option>
                    </select>
                </label>
            </div>
            <div class="number-display" id="targetNumber">${targetNumber}</div>
            <div class="buttons" id="numberButtons"></div>
            <div class="score" id="score">0</div>
            <div class="message" id="message"></div>
        `;
        document.getElementById('numberLevelSelect').value = level;
        document.getElementById('numberLevelSelect').onchange = function() {
            initializeNumberGame(this.value);
        };
        const numberButtons = document.getElementById('numberButtons');
        // Ê≠£Ëß£Ôºã‰∏çÊ≠£Ëß£„ÅÆÈÅ∏ÊäûËÇ¢„ÇíÁîüÊàê
        let choices = [targetNumber];
        while (choices.length < choiceCount) {
            let n = Math.floor(Math.random() * (max - min + 1)) + min;
            if (!choices.includes(n)) choices.push(n);
        }
        // „Ç∑„É£„ÉÉ„Éï„É´
        choices = choices.sort(() => Math.random() - 0.5);
        choices.forEach(num => {
            const btn = document.createElement('button');
            btn.textContent = num;
            btn.onclick = function() {
                if (num === targetNumber) {
                    score += 10;
                    document.getElementById('message').textContent = 'Ê≠£Ëß£ÔºÅ';
                    document.getElementById('score').textContent = score;
                    setTimeout(() => initializeNumberGame(level), 800);
                } else {
                    document.getElementById('message').textContent = 'ÈÅï„ÅÑ„Åæ„Åô';
                }
            };
            numberButtons.appendChild(btn);
        });
    }

    function openScoreModal() {
        document.getElementById('scoreModal').style.display = 'flex';
        toggleMenu();
    }

    function closeScoreModal() {
        document.getElementById('scoreModal').style.display = 'none';
    }

    function openSettingsModal() {
        document.getElementById('settingsModal').style.display = 'flex';
        toggleMenu();
    }

    function closeSettingsModal() {
        document.getElementById('settingsModal').style.display = 'none';
    }

    function openHelpModal() {
        document.getElementById('helpModal').style.display = 'flex';
        toggleMenu();
    }

    function closeHelpModal() {
        document.getElementById('helpModal').style.display = 'none';
    }

    function openMemoryGameModal() {
        document.getElementById('memoryGameModal').style.display = 'flex';
        initializeMemoryGame('normal');
    }

    function closeMemoryGameModal() {
        document.getElementById('memoryGameModal').style.display = 'none';
    }

    function initializeMemoryGame(level) {
        // „É¨„Éô„É´ÂèñÂæó
        if (!level) {
            level = document.getElementById('memoryLevelSelect')?.value || 'normal';
        }
        let digit, displayTime;
        if (level === 'easy') {
            digit = 3; displayTime = 5;
        } else if (level === 'hard') {
            digit = 5; displayTime = 3;
        } else {
            digit = 4; displayTime = 4;
        }
        const min = Math.pow(10, digit - 1);
        const max = Math.pow(10, digit) - 1;
        const pattern = Math.floor(Math.random() * (max - min + 1)) + min;
        let score = 0;
        const modalContent = document.getElementById('memoryGameModalContent');
        modalContent.innerHTML = `
            <span class="close" onclick="closeMemoryGameModal()">&times;</span>
            <div style="margin-bottom:10px;">
                <label>Èõ£ÊòìÂ∫¶:
                    <select id="memoryLevelSelect">
                        <option value="easy">Á∞°Âçò</option>
                        <option value="normal" selected>ÊôÆÈÄö</option>
                        <option value="hard">Èõ£„Åó„ÅÑ</option>
                    </select>
                </label>
            </div>
            <div class="memory-pattern" id="memoryPattern" style="font-size:2.5em;letter-spacing:0.2em;">${pattern}</div>
            <div id="memoryCountdown" style="font-size:1.5em;margin:10px 0;">${displayTime}</div>
            <div id="memoryInputArea" style="margin-top:20px;display:none;">
                <input id="memoryUserInput" type="text" inputmode="numeric" style="font-size:2em;width:120px;text-align:center;" maxlength="5" autocomplete="off" />
                <button id="memoryCheckBtn" style="font-size:1.2em;">Âà§ÂÆö</button>
            </div>
            <div class="score" id="memoryScore">0</div>
            <div class="message" id="memoryMessage"></div>
        `;
        document.getElementById('memoryLevelSelect').value = level;
        document.getElementById('memoryLevelSelect').onchange = function() {
            initializeMemoryGame(this.value);
        };
        let count = displayTime;
        const countdownEl = document.getElementById('memoryCountdown');
        const timer = setInterval(() => {
            count--;
            countdownEl.textContent = count;
            if (count === 0) {
                clearInterval(timer);
                document.getElementById('memoryPattern').textContent = 'ü§î';
                countdownEl.style.display = 'none';
                document.getElementById('memoryInputArea').style.display = 'block';
            }
        }, 1000);
        // Âà§ÂÆö„Éú„Çø„É≥
        document.getElementById('memoryCheckBtn').onclick = function() {
            const userInput = document.getElementById('memoryUserInput').value;
            if (userInput === String(pattern)) {
                score += 10;
                document.getElementById('memoryMessage').textContent = 'Ê≠£Ëß£ÔºÅ';
                document.getElementById('memoryScore').textContent = score;
            } else {
                document.getElementById('memoryMessage').textContent = 'ÈÅï„ÅÑ„Åæ„Åô';
            }
            setTimeout(() => {
                initializeMemoryGame(level);
            }, 1200);
        };
    }

    function openCalculationGameModal() {
        document.getElementById('calculationGameModal').style.display = 'flex';
        initializeCalculationGame();
    }

    function closeCalculationGameModal() {
        document.getElementById('calculationGameModal').style.display = 'none';
    }

    function initializeCalculationGame() {
        const totalQuestions = 20;
        let current = 0;
        let correct = 0;
        let questions = [];
        // ÂïèÈ°åÁîüÊàê
        function makeQuestion() {
            const ops = ['+', '-', '√ó', '√∑'];
            const op = ops[Math.floor(Math.random() * 4)];
            let a, b, answer;
            if (op === '+') {
                a = Math.floor(Math.random() * 90) + 10; // 10-99
                b = Math.floor(Math.random() * 90) + 10;
                answer = a + b;
            } else if (op === '-') {
                a = Math.floor(Math.random() * 90) + 10;
                b = Math.floor(Math.random() * a); // a > b
                answer = a - b;
            } else if (op === '√ó') {
                a = Math.floor(Math.random() * 9) + 2; // 2-10
                b = Math.floor(Math.random() * 9) + 2;
                answer = a * b;
            } else if (op === '√∑') {
                b = Math.floor(Math.random() * 9) + 2;
                answer = Math.floor(Math.random() * 9) + 2;
                a = b * answer;
            }
            return { a, b, op, answer };
        }
        for (let i = 0; i < totalQuestions; i++) {
            questions.push(makeQuestion());
        }
        const modalContent = document.getElementById('calculationGameModalContent');
        function showQuestion() {
            if (current >= totalQuestions) {
                modalContent.innerHTML = `
                    <span class="close" onclick="closeCalculationGameModal()">&times;</span>
                    <h2>Ë®àÁÆó„Ç≤„Éº„É† ÁµêÊûú</h2>
                    <p>Ê≠£Ëß£Êï∞Ôºö${correct} / ${totalQuestions}</p>
                    <button id="calcRetryBtn" style="font-size:1.2em;">„ÇÇ„ÅÜ‰∏ÄÂ∫¶</button>
                `;
                document.getElementById('calcRetryBtn').onclick = initializeCalculationGame;
                return;
            }
            const q = questions[current];
            modalContent.innerHTML = `
                <span class="close" onclick="closeCalculationGameModal()">&times;</span>
                <h2>Ë®àÁÆó„Ç≤„Éº„É† (${current+1} / ${totalQuestions})</h2>
                <div style="font-size:2em;margin:20px 0;">${q.a} ${q.op} ${q.b} = <input id="calcUserInput" type="number" style="font-size:1em;width:80px;text-align:center;" autocomplete="off" /></div>
                <button id="calcCheckBtn" style="font-size:1.2em;">Âà§ÂÆö</button>
                <div class="message" id="calcMessage"></div>
            `;
            document.getElementById('calcCheckBtn').onclick = function() {
                const userInput = document.getElementById('calcUserInput').value;
                if (String(userInput) === String(q.answer)) {
                    correct++;
                    document.getElementById('calcMessage').textContent = 'Ê≠£Ëß£ÔºÅ';
                } else {
                    document.getElementById('calcMessage').textContent = `ÈÅï„ÅÑ„Åæ„ÅôÔºàÊ≠£Ëß£: ${q.answer}Ôºâ`;
                }
                current++;
                setTimeout(showQuestion, 900);
            };
        }
        showQuestion();
    }

    function openWordGameModal() {
        document.getElementById('wordGameModal').style.display = 'flex';
        initializeWordGame();
    }

    function closeWordGameModal() {
        document.getElementById('wordGameModal').style.display = 'none';
    }

    function initializeWordGame() {
        // ÂïèÈ°å„É™„Çπ„ÉàÔºàÂ∞èÂ≠¶Áîü„É¨„Éô„É´Ôºâ
        const problems = [
            // „Å≤„Çâ„Åå„Å™‚Üí„Ç´„Çø„Ç´„Éä
            {q: '„Åï„Åè„Çâ', a: '„Çµ„ÇØ„É©', type: '„Å≤„Çâ„Åå„Å™‚Üí„Ç´„Çø„Ç´„Éä'},
            {q: '„Åô„ÅÑ„Åã', a: '„Çπ„Ç§„Ç´', type: '„Å≤„Çâ„Åå„Å™‚Üí„Ç´„Çø„Ç´„Éä'},
            {q: '„Åü„Åæ„Åî', a: '„Çø„Éû„Ç¥', type: '„Å≤„Çâ„Åå„Å™‚Üí„Ç´„Çø„Ç´„Éä'},
            {q: '„Åø„Åã„Çì', a: '„Éü„Ç´„É≥', type: '„Å≤„Çâ„Åå„Å™‚Üí„Ç´„Çø„Ç´„Éä'},
            // „Ç´„Çø„Ç´„Éä‚Üí„Å≤„Çâ„Åå„Å™
            {q: '„Éê„Éä„Éä', a: '„Å∞„Å™„Å™', type: '„Ç´„Çø„Ç´„Éä‚Üí„Å≤„Çâ„Åå„Å™'},
            {q: '„Éà„Éû„Éà', a: '„Å®„Åæ„Å®', type: '„Ç´„Çø„Ç´„Éä‚Üí„Å≤„Çâ„Åå„Å™'},
            {q: '„É°„É≠„É≥', a: '„ÇÅ„Çç„Çì', type: '„Ç´„Çø„Ç´„Éä‚Üí„Å≤„Çâ„Åå„Å™'},
            {q: '„Çµ„É´', a: '„Åï„Çã', type: '„Ç´„Çø„Ç´„Éä‚Üí„Å≤„Çâ„Åå„Å™'},
            // Êº¢Â≠ó‚ÜíË™≠„Åø
            {q: 'Â±±', a: '„ÇÑ„Åæ', type: 'Êº¢Â≠ó‚ÜíË™≠„Åø'},
            {q: 'Â∑ù', a: '„Åã„Çè', type: 'Êº¢Â≠ó‚ÜíË™≠„Åø'},
            {q: 'Á©∫', a: '„Åù„Çâ', type: 'Êº¢Â≠ó‚ÜíË™≠„Åø'},
            {q: 'Ëä±', a: '„ÅØ„Å™', type: 'Êº¢Â≠ó‚ÜíË™≠„Åø'},
            {q: 'Áä¨', a: '„ÅÑ„Å¨', type: 'Êº¢Â≠ó‚ÜíË™≠„Åø'},
            {q: 'Áå´', a: '„Å≠„Åì', type: 'Êº¢Â≠ó‚ÜíË™≠„Åø'},
            {q: 'Â≠¶Ê†°', a: '„Åå„Å£„Åì„ÅÜ', type: 'Êº¢Â≠ó‚ÜíË™≠„Åø'},
            {q: 'ÂÖàÁîü', a: '„Åõ„Çì„Åõ„ÅÑ', type: 'Êº¢Â≠ó‚ÜíË™≠„Åø'},
            {q: 'ÂèãÈÅî', a: '„Å®„ÇÇ„Å†„Å°', type: 'Êº¢Â≠ó‚ÜíË™≠„Åø'},
            {q: 'Êó•Êú¨', a: '„Å´„Åª„Çì', type: 'Êº¢Â≠ó‚ÜíË™≠„Åø'},
            {q: 'Êù±‰∫¨', a: '„Å®„ÅÜ„Åç„Çá„ÅÜ', type: 'Êº¢Â≠ó‚ÜíË™≠„Åø'}
        ];
        // 10Âïè„É©„É≥„ÉÄ„É†
        const shuffled = problems.sort(() => Math.random() - 0.5).slice(0, 10);
        let current = 0;
        let correctCount = 0;
        const modalContent = document.getElementById('wordGameModalContent');

        function showQuestion() {
            if (current >= shuffled.length) {
                modalContent.innerHTML = `
                    <span class="close" onclick="closeWordGameModal()">&times;</span>
                    <h2>ÊñáÂ≠ó„Ç≤„Éº„É† ÁµêÊûú</h2>
                    <p>Ê≠£Ëß£Êï∞Ôºö${correctCount} / ${shuffled.length}</p>
                    <button id="wordRetryBtn" style="font-size:1.2em;">„ÇÇ„ÅÜ‰∏ÄÂ∫¶</button>
                `;
                document.getElementById('wordRetryBtn').onclick = initializeWordGame;
                return;
            }
            const q = shuffled[current];
            
            // ÈÅ∏ÊäûËÇ¢„ÇíÁîüÊàê
            let choices = [q.a];
            while (choices.length < 4) {
                const randomProblem = problems[Math.floor(Math.random() * problems.length)];
                if (!choices.includes(randomProblem.a)) {
                    choices.push(randomProblem.a);
                }
            }
            // ÈÅ∏ÊäûËÇ¢„Çí„Ç∑„É£„ÉÉ„Éï„É´
            choices = choices.sort(() => Math.random() - 0.5);

            modalContent.innerHTML = `
                <span class="close" onclick="closeWordGameModal()">&times;</span>
                <h2>ÊñáÂ≠ó„Ç≤„Éº„É† (${current+1} / ${shuffled.length})</h2>
                <div style="font-size:1.2em;margin:10px 0;">„Äê${q.type}„Äë</div>
                <div style="font-size:2em;margin:20px 0;">${q.q}</div>
                <div class="buttons" style="grid-template-columns: repeat(2, 1fr); gap: 20px; max-width: 600px; margin: 20px auto;">
                    ${choices.map((choice, index) => `
                        <button onclick="window.checkAnswer('${choice}', '${q.a}')" 
                                style="font-size:1.5em; padding: 15px;">
                            ${choice}
                        </button>
                    `).join('')}
                </div>
                <div class="message" id="wordMessage"></div>
            `;
        }

        // „Ç∞„É≠„Éº„Éê„É´„Çπ„Ç≥„Éº„Éó„Å´checkAnswerÈñ¢Êï∞„ÇíÂÆöÁæ©
        window.checkAnswer = function(selected, correct) {
            const messageEl = document.getElementById('wordMessage');
            if (selected === correct) {
                messageEl.textContent = 'Ê≠£Ëß£ÔºÅ';
                correctCount++;
                current++;
                setTimeout(showQuestion, 900);
            } else {
                messageEl.textContent = `ÈÅï„ÅÑ„Åæ„ÅôÔºàÊ≠£Ëß£: ${correct}Ôºâ`;
                setTimeout(() => {
                    messageEl.textContent = '';
                }, 900);
            }
        };

        showQuestion();
    }

    function openReactionGameModal() {
        document.getElementById('reactionGameModal').style.display = 'flex';
        initializeReactionGame();
    }

    function closeReactionGameModal() {
        document.getElementById('reactionGameModal').style.display = 'none';
    }

    function initializeReactionGame() {
        const modalContent = document.getElementById('reactionGameModalContent');
        let trial = 0;
        let results = [];
        let waiting = false;
        let startTime = 0;
        let timeoutId = null;
        let intervalId = null;
        function showStart() {
            modalContent.innerHTML = `
                <span class="close" onclick="closeReactionGameModal()">&times;</span>
                <h2>ÂèçÂøú„Ç≤„Éº„É†</h2>
                <p>"„Çπ„Çø„Éº„Éà"„Éú„Çø„É≥„ÇíÊäº„Åó„Å¶„ÄÅÁîªÈù¢„ÅåÂ§â„Çè„Å£„Åü„Çâ„Åô„Åê„Å´"‰ªä„Å†ÔºÅ"„ÇíÊäº„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ<br>5ÂõûË®àÊ∏¨„Åó„Åæ„Åô„ÄÇ</p>
                <button id="reactionStartBtn" style="font-size:1.5em;">„Çπ„Çø„Éº„Éà</button>
                <div class="message" id="reactionMessage"></div>
            `;
            document.getElementById('reactionStartBtn').onclick = startTrial;
        }
        function startTrial() {
            modalContent.innerHTML = `
                <span class="close" onclick="closeReactionGameModal()">&times;</span>
                <h2>ÂèçÂøú„Ç≤„Éº„É† (${trial+1}/5)</h2>
                <p style="font-size:1.3em;">"‰ªä„Å†ÔºÅ"„ÅåÂá∫„Çã„Åæ„ÅßÂæÖ„Å£„Å¶„Åè„Å†„Åï„ÅÑ‚Ä¶</p>
                <button id="waitBtn" style="font-size:1.5em;" disabled>ÂæÖÊ©ü‰∏≠...</button>
                <div class="message" id="reactionMessage"></div>
            `;
            waiting = true;
            const waitTime = Math.random() * 2000 + 1000; // 1ÔΩû3Áßí
            timeoutId = setTimeout(() => {
                showNowBtn();
            }, waitTime);
            document.getElementById('waitBtn').onclick = function() {
                if (waiting) {
                    clearTimeout(timeoutId);
                    document.getElementById('reactionMessage').textContent = '„Éï„É©„Ç§„É≥„Ç∞ÔºÅ„ÇÇ„ÅÜ‰∏ÄÂ∫¶„Çπ„Çø„Éº„Éà„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ';
                    setTimeout(showStart, 1200);
                }
            };
        }
        function showNowBtn() {
            waiting = false;
            startTime = Date.now();
            modalContent.innerHTML = `
                <span class="close" onclick="closeReactionGameModal()">&times;</span>
                <h2>ÂèçÂøú„Ç≤„Éº„É† (${trial+1}/5)</h2>
                <button id="nowBtn" style="font-size:2em;background:var(--accent-color);color:#fff;">‰ªä„Å†ÔºÅ</button>
                <div style="font-size:1.5em;margin:10px 0;">ÂèçÂøúÊôÇÈñì: <span id="realtimeMs">0.00</span> Áßí</div>
                <div class="message" id="reactionMessage"></div>
            `;
            // „É™„Ç¢„É´„Çø„Ç§„É†Ë°®Á§∫
            const realtimeMs = document.getElementById('realtimeMs');
            intervalId = setInterval(() => {
                realtimeMs.textContent = ((Date.now() - startTime) / 1000).toFixed(2);
            }, 10);
            document.getElementById('nowBtn').onclick = function() {
                const reaction = Date.now() - startTime;
                clearInterval(intervalId);
                results.push(reaction);
                trial++;
                if (trial < 5) {
                    document.getElementById('reactionMessage').textContent = `ÂèçÂøúÊôÇÈñì: ${(reaction/1000).toFixed(2)} Áßí`;
                    setTimeout(startTrial, 1000);
                } else {
                    showResult();
                }
            };
        }
        function showResult() {
            const avg = Math.round(results.reduce((a,b)=>a+b,0)/results.length);
            modalContent.innerHTML = `
                <span class="close" onclick="closeReactionGameModal()">&times;</span>
                <h2>ÂèçÂøú„Ç≤„Éº„É† ÁµêÊûú</h2>
                <p>Âπ≥ÂùáÂèçÂøúÊôÇÈñì: <b>${(avg/1000).toFixed(2)} Áßí</b></p>
                <p>ÂêÑÂõû„ÅÆÂèçÂøúÊôÇÈñì: ${results.map(r=>(r/1000).toFixed(2)+'Áßí').join(', ')}</p>
                <button id="reactionRetryBtn" style="font-size:1.2em;">„ÇÇ„ÅÜ‰∏ÄÂ∫¶</button>
            `;
            document.getElementById('reactionRetryBtn').onclick = function() {
                trial = 0;
                results = [];
                showStart();
            };
        }
        showStart();
    }

    function openJigsawGameModal() {
        document.getElementById('jigsawGameModal').style.display = 'flex';
        initializeJigsawGame(3);
    }

    function closeJigsawGameModal() {
        document.getElementById('jigsawGameModal').style.display = 'none';
    }

    function initializeJigsawGame(size) {
        // „Çµ„Ç§„Ç∫ÂèñÂæó
        if (!size) {
            size = parseInt(document.getElementById('jigsawSizeSelect')?.value) || 3;
        }
        // „Åã„Çè„ÅÑ„ÅÑÂãïÁâ©„ÅÆÁîªÂÉè„É™„Çπ„Éà
        const animalImages = [
            'https://cdn.pixabay.com/photo/2017/11/09/21/41/cat-2934720_1280.jpg',
            'https://cdn.pixabay.com/photo/2016/02/19/10/00/puppy-1207816_1280.jpg',
            'https://cdn.pixabay.com/photo/2015/03/26/09/54/bunny-690567_1280.jpg',
            'https://cdn.pixabay.com/photo/2016/11/29/04/17/adorable-1866530_1280.jpg',
            'https://cdn.pixabay.com/photo/2017/07/31/11/21/dog-2556794_1280.jpg',
            'https://cdn.pixabay.com/photo/2016/02/13/12/26/ducklings-1198549_1280.jpg',
            'https://cdn.pixabay.com/photo/2016/03/27/22/16/puppy-1284307_1280.jpg',
            'https://cdn.pixabay.com/photo/2017/01/06/19/15/animal-1959827_1280.jpg',
            'https://cdn.pixabay.com/photo/2016/12/13/05/15/puppy-1903313_1280.jpg',
            'https://cdn.pixabay.com/photo/2017/02/20/18/03/cat-2083492_1280.jpg',
            'https://cdn.pixabay.com/photo/2016/11/29/05/45/astronaut-1867616_1280.jpg',
            'https://cdn.pixabay.com/photo/2016/11/29/09/38/adult-1868750_1280.jpg',
            'https://cdn.pixabay.com/photo/2016/11/29/09/38/adult-1868750_1280.jpg',
            'https://cdn.pixabay.com/photo/2016/11/29/09/38/adult-1868750_1280.jpg',
            'https://cdn.pixabay.com/photo/2016/11/29/09/38/adult-1868750_1280.jpg',
            'https://cdn.pixabay.com/photo/2016/11/29/09/38/adult-1868750_1280.jpg'
        ];
        const imgUrl = animalImages[Math.floor(Math.random() * animalImages.length)];
        let tiles = [];
        for (let i = 0; i < size * size; i++) tiles.push(i);
        // „Ç∑„É£„ÉÉ„Éï„É´
        do {
            tiles = tiles.sort(() => Math.random() - 0.5);
        } while (!isSolvable(tiles, size) || isCompleted(tiles));
        const modalContent = document.getElementById('jigsawGameModalContent');
        modalContent.innerHTML = `<span class=\"close\" onclick=\"closeJigsawGameModal()\">&times;</span><h2>„Ç∏„Ç∞„ÇΩ„Éº„Éë„Ç∫„É´</h2><div style='margin-bottom:10px;'><label>„Çµ„Ç§„Ç∫: <select id='jigsawSizeSelect'><option value='3'>3x3</option><option value='4'>4x4</option></select></label></div><div style='margin-bottom:20px;text-align:center;'><div style='font-size:1.2em;margin-bottom:10px;color:var(--secondary-color);'>Ë¶ãÊú¨</div><img src='${imgUrl}' alt='Ë¶ãÊú¨' style='width:150px;height:150px;object-fit:cover;border:3px solid var(--primary-color);border-radius:12px;box-shadow:0 4px 8px rgba(0,0,0,0.1);'></div><div id=\"jigsawBoard\" style=\"display:grid;grid-template-columns:repeat(${size},1fr);gap:2px;width:300px;height:300px;margin:0 auto;\"></div><div class=\"message\" id=\"jigsawMessage\"></div>`;
        document.getElementById('jigsawSizeSelect').value = size;
        document.getElementById('jigsawSizeSelect').onchange = function() {
            initializeJigsawGame(parseInt(this.value));
        };
        renderJigsawBoard(tiles, size, imgUrl);
    }

    function renderJigsawBoard(tiles, size, imgUrl) {
        const board = document.getElementById('jigsawBoard');
        board.innerHTML = '';
        tiles.forEach((tile, idx) => {
            const div = document.createElement('div');
            div.style.width = div.style.height = (300/size) + 'px';
            div.style.boxSizing = 'border-box';
            div.style.border = '1px solid #ccc';
            if (tile !== size*size-1) {
                div.style.backgroundImage = `url('${imgUrl}')`;
                div.style.backgroundSize = `${size*100}% ${size*100}%`;
                div.style.backgroundPosition = `${(tile%size)*100/(size-1)}% ${(Math.floor(tile/size))*100/(size-1)}%`;
                div.style.cursor = 'pointer';
                div.onclick = function() {
                    moveJigsawTile(tiles, idx, size, imgUrl);
                };
            } else {
                div.style.background = '#eee';
            }
            board.appendChild(div);
        });
    }

    function moveJigsawTile(tiles, idx, size, imgUrl) {
        const emptyIdx = tiles.indexOf(size*size-1);
        const canMove = [
            emptyIdx-1, emptyIdx+1, emptyIdx-size, emptyIdx+size
        ].includes(idx) &&
        !(emptyIdx%size===0 && idx===emptyIdx-1) &&
        !((emptyIdx+1)%size===0 && idx===emptyIdx+1);
        if (canMove) {
            [tiles[emptyIdx], tiles[idx]] = [tiles[idx], tiles[emptyIdx]];
            renderJigsawBoard(tiles, size, imgUrl);
            if (isCompleted(tiles)) {
                document.getElementById('jigsawMessage').textContent = 'ÂÆåÊàêÔºÅ„Åä„ÇÅ„Åß„Å®„ÅÜÔºÅ';
            }
        }
    }

    function isCompleted(tiles) {
        return tiles.every((v,i)=>v===i);
    }

    function isSolvable(tiles, size) {
        let inv = 0;
        for (let i = 0; i < tiles.length-1; i++) {
            for (let j = i+1; j < tiles.length; j++) {
                if (tiles[i] !== size*size-1 && tiles[j] !== size*size-1 && tiles[i] > tiles[j]) inv++;
            }
        }
        if (size%2===1) return inv%2===0;
        const emptyRow = Math.floor(tiles.indexOf(size*size-1)/size);
        return (inv + emptyRow)%2===1;
    }

    function openCrossShapeGameModal() {
        document.getElementById('crossShapeGameModal').style.display = 'flex';
        initializeCrossShapeGame();
    }

    function closeCrossShapeGameModal() {
        document.getElementById('crossShapeGameModal').style.display = 'none';
    }

    function initializeCrossShapeGame() {
        const shapes = [
            {type: 'circle', color: '#3498db', label: '‚óã'},
            {type: 'triangle', color: '#e67e22', label: '‚ñ≥'},
            {type: 'square', color: '#2ecc71', label: '‚ñ°'},
            {type: 'star', color: '#f1c40f', label: '‚òÖ'}
        ];
        // Ê≠£Ëß£„Çí„É©„É≥„ÉÄ„É†„ÅßÈÅ∏„Å∂
        const answerIdx = Math.floor(Math.random() * shapes.length);
        const answerShape = shapes[answerIdx];
        const modalContent = document.getElementById('crossShapeGameModalContent');
        modalContent.innerHTML = `<span class='close' onclick='closeCrossShapeGameModal()'>&times;</span><h2>Ê®™Âàá„ÇãÂõ≥ÂΩ¢„Ç≤„Éº„É†</h2><div id='crossShapeCanvasArea' style='width:320px;height:120px;margin:0 auto;position:relative;background:#f8f8f8;border-radius:10px;overflow:hidden;'></div><div id='crossShapeChoices' style='margin-top:30px;display:none;'></div><div class='message' id='crossShapeMessage'></div>`;
        // Âõ≥ÂΩ¢„ÇíÊ®™Âàá„Çâ„Åõ„Çã
        animateCrossShape(answerShape, () => {
            // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥Âæå„Å´ÈÅ∏ÊäûËÇ¢„ÇíË°®Á§∫
            showCrossShapeChoices(shapes, answerIdx);
        });
    }

    function animateCrossShape(shape, onEnd) {
        const area = document.getElementById('crossShapeCanvasArea');
        area.innerHTML = '';
        const svgNS = 'http://www.w3.org/2000/svg';
        const svg = document.createElementNS(svgNS, 'svg');
        svg.setAttribute('width', '320');
        svg.setAttribute('height', '120');
        svg.style.position = 'absolute';
        svg.style.left = '0';
        svg.style.top = '0';
        let shapeElem;
        if (shape.type === 'circle') {
            shapeElem = document.createElementNS(svgNS, 'circle');
            shapeElem.setAttribute('cx', '30');
            shapeElem.setAttribute('cy', '60');
            shapeElem.setAttribute('r', '28');
            shapeElem.setAttribute('fill', shape.color);
        } else if (shape.type === 'triangle') {
            shapeElem = document.createElementNS(svgNS, 'polygon');
            shapeElem.setAttribute('points', '30,20 58,100 2,100');
            shapeElem.setAttribute('fill', shape.color);
            shapeElem.setAttribute('transform', 'translate(0,0)');
        } else if (shape.type === 'square') {
            shapeElem = document.createElementNS(svgNS, 'rect');
            shapeElem.setAttribute('x', '2');
            shapeElem.setAttribute('y', '32');
            shapeElem.setAttribute('width', '56');
            shapeElem.setAttribute('height', '56');
            shapeElem.setAttribute('fill', shape.color);
        } else if (shape.type === 'star') {
            shapeElem = document.createElementNS(svgNS, 'polygon');
            shapeElem.setAttribute('points', '30,5 36,25 58,25 40,38 46,58 30,46 14,58 20,38 2,25 24,25');
            shapeElem.setAttribute('fill', shape.color);
            shapeElem.setAttribute('transform', 'translate(0,0)');
        }
        svg.appendChild(shapeElem);
        area.appendChild(svg);
        // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥
        let pos = -60;
        const end = 320;
        const speed = 6; // px/frame
        function frame() {
            pos += speed;
            svg.style.left = pos + 'px';
            if (pos < end) {
                requestAnimationFrame(frame);
            } else {
                area.innerHTML = '';
                if (onEnd) onEnd();
            }
        }
        frame();
    }

    function showCrossShapeChoices(shapes, answerIdx) {
        const choicesDiv = document.getElementById('crossShapeChoices');
        choicesDiv.innerHTML = '<div style="font-size:1.2em;margin-bottom:10px;">Ê®™Âàá„Å£„ÅüÂõ≥ÂΩ¢„ÅØ„Å©„ÇåÔºü</div>' +
            shapes.map((s, i) => `<button onclick='checkCrossShapeAnswer(${i},${answerIdx})' style='font-size:2em;padding:15px 30px;margin:10px;border-radius:10px;border:2px solid #ccc;background:#fff;cursor:pointer;'>${s.label}</button>`).join('');
        choicesDiv.style.display = 'block';
    }

    function checkCrossShapeAnswer(selectedIdx, answerIdx) {
        const msg = document.getElementById('crossShapeMessage');
        if (selectedIdx === answerIdx) {
            msg.textContent = 'Ê≠£Ëß£ÔºÅ';
        } else {
            msg.textContent = 'ÈÅï„ÅÑ„Åæ„Åô';
        }
    }

    function openHiddenNumberGameModal() {
        document.getElementById('hiddenNumberGameModal').style.display = 'flex';
        initializeHiddenNumberGame();
    }

    function closeHiddenNumberGameModal() {
        document.getElementById('hiddenNumberGameModal').style.display = 'none';
    }

    function initializeHiddenNumberGame() {
        const modalContent = document.getElementById('hiddenNumberGameModalContent');
        // Ê≠£Ëß£„ÅÆÊï∞Â≠ó„Çí„É©„É≥„ÉÄ„É†„ÅßÊ±∫ÂÆö
        const answer = Math.floor(Math.random() * 90) + 10; // 2Ê°Å
        // ÈÅ∏ÊäûËÇ¢„Çí‰ΩúÊàê
        let choices = [answer];
        while (choices.length < 4) {
            let n = Math.floor(Math.random() * 90) + 10;
            if (!choices.includes(n)) choices.push(n);
        }
        choices = choices.sort(() => Math.random() - 0.5);
        modalContent.innerHTML = `<span class='close' onclick='closeHiddenNumberGameModal()'>&times;</span><h2>Èö†„ÇåÊï∞Â≠ó„Ç≤„Éº„É†</h2><div id='hiddenNumberArea' style='width:200px;height:120px;margin:30px auto 10px auto;display:flex;align-items:center;justify-content:center;font-size:3em;background:#f8f8f8;border-radius:10px;'></div><div id='hiddenNumberChoices' style='margin-top:30px;display:none;'></div><div class='message' id='hiddenNumberMessage'></div>`;
        // Êï∞Â≠ó„Çí‰∏ÄÁû¨Ë°®Á§∫
        const area = document.getElementById('hiddenNumberArea');
        const choicesDiv = document.getElementById('hiddenNumberChoices');
        area.textContent = answer;
        choicesDiv.style.display = 'none'; // ÂàùÊúüÂåñ„ÅßÂøÖ„ÅöÈùûË°®Á§∫
        setTimeout(() => {
            area.textContent = '';
            showHiddenNumberChoices(choices, answer);
        }, 1000);
    }

    function showHiddenNumberChoices(choices, answer) {
        const choicesDiv = document.getElementById('hiddenNumberChoices');
        choicesDiv.innerHTML = '<div style="font-size:1.2em;margin-bottom:10px;">Èö†„Çå„Å¶„ÅÑ„ÅüÊï∞Â≠ó„ÅØ„Å©„ÇåÔºü</div>' +
            choices.map(n => `<button onclick='checkHiddenNumberAnswer(${n},${answer})' style='font-size:2em;padding:15px 30px;margin:10px;border-radius:10px;border:2px solid #ccc;background:#fff;cursor:pointer;'>${n}</button>`).join('');
        choicesDiv.style.display = 'block';
    }

    function checkHiddenNumberAnswer(selected, answer) {
        const msg = document.getElementById('hiddenNumberMessage');
        if (selected === answer) {
            msg.textContent = 'Ê≠£Ëß£ÔºÅ';
        } else {
            msg.textContent = 'ÈÅï„ÅÑ„Åæ„Åô';
        }
    }

    function openMemoryMatchGameModal() {
        document.getElementById('memoryMatchGameModal').style.display = 'flex';
        initializeMemoryMatchGame();
    }

    function closeMemoryMatchGameModal() {
        document.getElementById('memoryMatchGameModal').style.display = 'none';
    }

    function initializeMemoryMatchGame() {
        const size = 4; // 4x4
        const total = size * size;
        // 8„Éö„Ç¢„ÅÆ„Éà„É©„É≥„ÉóÔºàÁµµÊüÑÔºãÊï∞Â≠óÔºâ
        const suits = ['‚ô•', '‚ô†', '‚ô¶', '‚ô£'];
        const ranks = ['A', 'K', 'Q', 'J', '10', '9', '8', '7'];
        let cardFaces = [];
        for (let i = 0; i < 8; i++) {
            cardFaces.push(suits[i % 4] + ranks[i]);
            cardFaces.push(suits[i % 4] + ranks[i]);
        }
        // „Ç∑„É£„ÉÉ„Éï„É´
        cardFaces = cardFaces.sort(() => Math.random() - 0.5);
        let openIndexes = [];
        let matched = Array(total).fill(false);
        let lock = false;
        const modalContent = document.getElementById('memoryMatchGameModalContent');
        modalContent.innerHTML = `<span class='close' onclick='closeMemoryMatchGameModal()'>&times;</span><h2>Á•ûÁµåË°∞Âº±„Ç≤„Éº„É†</h2><div id='memoryMatchBoard' style='display:grid;grid-template-columns:repeat(${size},1fr);gap:10px;width:320px;margin:0 auto;'></div><div class='message' id='memoryMatchMessage'></div>`;
        renderMemoryMatchBoard();

        function renderMemoryMatchBoard() {
            const board = document.getElementById('memoryMatchBoard');
            board.innerHTML = '';
            for (let i = 0; i < total; i++) {
                const btn = document.createElement('button');
                btn.style.width = btn.style.height = '70px';
                btn.style.fontSize = '2em';
                btn.style.borderRadius = '10px';
                btn.style.background = matched[i] ? '#eee' : '#3498db';
                btn.style.color = matched[i] ? '#888' : (cardFaces[i][0] === '‚ô•' || cardFaces[i][0] === '‚ô¶' ? '#e74c3c' : '#222');
                btn.textContent = (openIndexes.includes(i) || matched[i]) ? cardFaces[i] : 'Ôºü';
                btn.disabled = matched[i] || openIndexes.includes(i) || lock;
                btn.onclick = function() {
                    if (lock || openIndexes.includes(i) || matched[i]) return;
                    openIndexes.push(i);
                    renderMemoryMatchBoard();
                    if (openIndexes.length === 2) {
                        lock = true;
                        setTimeout(() => {
                            const [a, b] = openIndexes;
                            if (cardFaces[a] === cardFaces[b]) {
                                matched[a] = matched[b] = true;
                                document.getElementById('memoryMatchMessage').textContent = '„Éö„Ç¢ÊàêÁ´ãÔºÅ';
                            } else {
                                document.getElementById('memoryMatchMessage').textContent = 'ÈÅï„ÅÑ„Åæ„Åô';
                            }
                            openIndexes = [];
                            renderMemoryMatchBoard();
                            lock = false;
                            if (matched.every(x => x)) {
                                document.getElementById('memoryMatchMessage').textContent = '„ÇØ„É™„Ç¢ÔºÅ„Åä„ÇÅ„Åß„Å®„ÅÜÔºÅ';
                            }
                        }, 800);
                    }
                };
                board.appendChild(btn);
            }
        }
    }

    document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('fontSizeSlider').oninput = function() {
            document.getElementById('fontSizeValue').textContent = this.value;
        };
        document.getElementById('volumeSlider').oninput = function() {
            document.getElementById('volumeValue').textContent = this.value;
        };
        document.getElementById('animationSpeedSlider').oninput = function() {
            document.getElementById('animationSpeedValue').textContent = this.value;
        };
    });
    </script>
</body>
</html> 